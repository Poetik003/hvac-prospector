<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Integration - Iframe Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        /* Iframe-optimized styling */
        body { 
            margin: 0; 
            padding: 0; 
            background: transparent !important;
            min-height: 280px;
        }
        .iframe-container { 
            padding: 16px; 
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="iframe-container">
        <div class="space-y-4">
            <!-- Enhanced Calendar Buttons with Better Mobile Support -->
            <button 
                id="google-calendar-btn"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors font-medium border border-blue-500 hover:border-blue-400 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                <i class="fab fa-google mr-2"></i>Connect Google Calendar
            </button>
            
            <button 
                id="outlook-calendar-btn"
                class="w-full bg-blue-800 hover:bg-blue-900 text-white py-3 px-4 rounded-lg transition-colors font-medium border border-blue-600 hover:border-blue-500 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                <i class="fab fa-microsoft mr-2"></i>Connect Outlook
            </button>
            
            <button 
                id="schedule-appointment-btn"
                class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors font-medium border border-green-500 hover:border-green-400 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                <i class="fas fa-calendar-plus mr-2"></i>Schedule New Appointment
            </button>
        </div>
    </div>

    <script>
        // Enhanced calendar button functionality
        function isMobile() {
            return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        }

        function openCalendarService(service, url) {
            console.log(`ðŸ“… ${service} button clicked in iframe`);
            
            // Always try to open in parent window for better compatibility
            try {
                if (window.parent !== window) {
                    // We're in an iframe - try to navigate parent
                    window.parent.location.href = url;
                } else if (isMobile()) {
                    // Mobile device - use location.href
                    window.location.href = url;
                } else {
                    // Desktop - use window.open
                    window.open(url, '_blank');
                }
            } catch (e) {
                console.error('Calendar navigation error:', e);
                // Fallback - try direct navigation
                if (isMobile()) {
                    window.location.href = url;
                } else {
                    window.open(url, '_blank');
                }
            }
        }

        // Event listeners for calendar buttons
        document.getElementById('google-calendar-btn').addEventListener('click', function(e) {
            e.preventDefault();
            openCalendarService('Google Calendar', 'https://accounts.google.com/signin');
        });

        document.getElementById('outlook-calendar-btn').addEventListener('click', function(e) {
            e.preventDefault();
            openCalendarService('Microsoft Outlook', 'https://login.microsoftonline.com/');
        });

        document.getElementById('schedule-appointment-btn').addEventListener('click', function(e) {
            e.preventDefault();
            console.log('ðŸ“… Schedule New Appointment clicked in iframe');
            
            // Try to communicate with parent window
            try {
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'schedule_appointment',
                        message: 'Schedule appointment button clicked in iframe'
                    }, '*');
                }
            } catch (e) {
                console.error('Parent communication error:', e);
            }
            
            alert('Schedule Appointment - This would open the appointment scheduling modal in the main application.');
        });

        // Visual feedback for iframe load
        console.log('âœ… Calendar iframe loaded successfully');
        
        // Add visual indicator that iframe is working
        document.body.style.border = '2px solid #22c55e';
        document.body.style.borderRadius = '8px';
        setTimeout(() => {
            document.body.style.border = 'none';
        }, 2000);
    </script>
</body>
</html>